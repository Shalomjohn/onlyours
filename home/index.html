<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>OnlyOurs - Home</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <link rel="stylesheet" href="home/css/bootstrap.min.css">
    <link rel="stylesheet" href="home/css/aos.min.css">
    <link rel="stylesheet" href="home/css/hamburgers/hamburgers.min.css">
    <link rel="stylesheet" href="home/css/owl.carousel.min.css">
    <link rel="stylesheet" href="home/fonts/icomoon/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animsition/4.0.2/css/animsition.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Space+Mono:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="home/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.8.2/css/lightgallery.css" rel="stylesheet">
    <style>
        /* body {
            background-color: #152836
        } */

        ul.new-style {
            display: flex;
            flex-wrap: wrap;
            margin-left: 30px;
        }

        li.new-style {
            height: 40vh;
            flex-grow: 1;
        }

        /* ul li.last {
            flex-grow: 1;
        } */

        img {
            max-height: 100%;
            min-width: 50%;
            object-fit: cover;
            vertical-align: bottom;
        }

        @media (max-aspect-ratio: 1/1) and (max-width: 480px) {
            ul.new-style {
                flex-direction: row;
                margin-left: 15px;
            }

            li.new-style {
                height: auto;
                width: 100%;
            }

            img {
                width: 100%;
                max-height: 75vh;
                min-width: 0;
            }
        }
    </style>
</head>

<body>

    <div class="js-animsition animsition" data-animsition-in-class="fade-in" data-animsition-out-class="fade-out">

        <header class="templateux-navbar" data-aos="fade-down">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-3 col-3">
                        <div class="site-logo"><a style="font-family: 'Pacifico', cursive;" href="index.html"
                                class="animsition-link">OnlyOurs</a></div>
                    </div>
                    <div class="col-sm-9 col-9 text-right">

                        <button class="hamburger hamburger--spin toggle-menu ml-auto js-toggle-menu" type="button">
                            <span class="hamburger-box">
                                <span class="hamburger-inner"></span>
                            </span>
                        </button>

                        <nav class="templateux-menu js-templateux-menu" role="navigation">
                            <ul class="list-unstyled">
                                <!-- <li class="d-md-none d-block active"><a href="index.html" class="animsition-link">Home</a></li> -->
                                <li class="active"><a href="index.html" class="animsition-link">All</a></li>
                                <li><a href="home/photos" class="animsition-link">Photos</a></li>
                                <li><a href="home/videos" class="animsition-link">Videos</a>
                                </li>
                                <li><a onclick="moveToUploadPage();" href="home/upload"
                                        class="animsition-link">Upload</a></li>
                                <li><a onclick="moveToLogoutPage();" href="#" class="animsition-link">Logout</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </header>

        <br><br><br><br><br><br>
        <div class="text-center">
            <h3>Recents:</h3>
        </div>
        <!-- <section class="templateux-hero">
            <div class="container">
                <div class="row align-items-center justify-content-center intro">
                    <div class="col-md-3" data-aos="fade-up">
                        <h3>Recents:</h3>
                    </div>
                </div>
            </div>
        </section> -->
        <div id="add-to-me" class="js-smoothscroll" data-aos="fade-up"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/picturefill/2.3.1/picturefill.min.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lightgallery.js/master/dist/js/lightgallery.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lg-pager.js/master/dist/lg-pager.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lg-autoplay.js/master/dist/lg-autoplay.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lg-fullscreen.js/master/dist/lg-fullscreen.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lg-zoom.js/master/dist/lg-zoom.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lg-hash.js/master/dist/lg-hash.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lg-share.js/master/dist/lg-share.js"></script>
    <script src="home/lightgallery/js/lg-rotate.js"></script>


    <script src="home/js/scripts-all.js"></script>
    <script src="home/js/main.js"></script>
    <!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-storage.js"></script>

    <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-analytics.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-database.js"></script>

    <script>
        lightGallery(document.getElementById('lightgallery'));
        var iterNum = 0;
        var currentIterNum = 0;
        var itemsCompletelyLoaded = false;

        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyCwwpjIxuPhlW_PIVpOVbiQWja70KNYUp8",
            authDomain: "onlyyours-8f634.firebaseapp.com",
            databaseURL: "https://onlyyours-8f634.firebaseio.com",
            projectId: "onlyyours-8f634",
            storageBucket: "onlyyours-8f634.appspot.com",
            messagingSenderId: "975933856881",
            appId: "1:975933856881:web:a2205a94c9833f6a344fd0",
            measurementId: "G-1FLYVDMRX5"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();

        firebase.auth().onAuthStateChanged(function (user) {
            console.log(user.displayName);
            if (user) {
                // User is signed in.
                var displayName = user.displayName;
                var email = user.email;
                var emailVerified = user.emailVerified;
                var photoURL = user.photoURL;
                var isAnonymous = user.isAnonymous;
                var uid = user.uid;
                var providerData = user.providerData;
                // ...
                console.log(displayName);
            } else {
                // document.location.href = "/";
            }
        });

        function scrollWin() {
            window.scrollBy(0, 100);
        }

        function moveToUploadPage() {
            document.location.href = "home/upload";
        }

        function moveToVideosPage() {
            document.location.href = "home/videos";
        }

        function moveToPhotosPage() {
            document.location.href = "home/photos";
        }

        function moveToLogoutPage() {
            firebase.auth().signOut().then(function () {
                document.location.href = "../index.html";
            }).catch(function (error) {
                alert(error);
            });
        }

        function newPost(userDisplayName, datePosted, mediaPosted, iterNum) {
            front = `
            <br><br><br><br>
      <div class="container" data-aos="fade-up">
        <h5>Uploaded by: ${userDisplayName}</h5>
        <h5>Upload Date: ${datePosted}</h5>
        <br>
        <div class="row">
          <ul id="lightgallery${iterNum}" class="list-unstyled row new-style">`;

            var middle = "";

            for (let i = 0; i < mediaPosted.length; i++) {
                displayThumbnails(mediaPosted[i], i);
            }

            function displayThumbnails(value, iteration) {
                if (value.includes(".mp4")) {
                    middle = middle +
                        `
                        <li class="new-style col">
                          <video width="320" height="240" controls>
                            <source src="${value}" type="video/mp4">
                          Your browser does not support the video tag.
                          </video>
                    </li>`;
                } else {
                    middle = middle +
                        `
            <li class="new-style col" data-aos="fade-up"
                    data-responsive="${value} 375, ${value} 480, ${value} 800"
                    data-src="${value}">
                    <a href="${value}" onclick="scrollWin();return false;" target="_blank">
                        <img style="width:7em; height:7em;" src="${value}" alt="Thumb-3">
                    </a>
                </li>`;
                }
            }
            var ending = `
          </ul>
        </div>
        </div>
        <br>
        `;
            return front + middle;
        }

        firebase.database().ref("posts/").on('value', function (snap) {

            var dataList = [];

            snap.forEach(function (childNodes) {

                dataList.unshift(newPost(childNodes.val().user, childNodes.val().uploadTime, childNodes.val().fileLinks, iterNum));
                iterNum += 1;

            });

            dataList.forEach(myFunction);

            function myFunction(value) {
                document.getElementById("add-to-me").innerHTML += value;
            }
        });
        // document.getElementById("add-to-me").innerHTML += "<p>ALOHA</p>";
        // lightGallery(document.getElementById('lightgallery2'));

        function func() {
            if (!(currentIterNum == iterNum)) {
                console.log(iterNum);
                currentIterNum = iterNum;
                console.log("This is after five seconds");
                for (let i = 0; i < iterNum; i++) {
                    var idName = `lightgallery${i}`;
                    console.log(idName)
                    lightGallery(document.getElementById(idName));
                }
            }
        }
        setInterval("func()", 1000);

    </script>
</body>

</html>